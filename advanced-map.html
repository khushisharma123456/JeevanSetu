<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Mapping & Tracking - DisasterSafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --safe: #4285f4;
            --light: #f8f9fa;
            --dark: #202124;
            --card-bg: #ffffff;
            --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --danger: #dc3545;
            --success: #28a745;
            --evacuation: #ff9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-bg);
            min-height: 100vh;
            color: var(--dark);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .logo i {
            margin-right: 10px;
            color: var(--secondary);
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-menu a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-menu a:hover {
            color: var(--primary);
        }

        .container {
            max-width: 100%;
            margin: 0;
            padding: 80px 0 0 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .map-controls {
            background: white;
            padding: 15px 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            z-index: 1000;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-label {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .control-select, .control-input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
            transition: var(--transition);
        }

        .control-select:focus, .control-input:focus {
            border-color: var(--primary);
        }

        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--safe);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .map-container {
            flex: 1;
            position: relative;
            display: flex;
        }

        #map {
            flex: 1;
            height: 100%;
            min-height: 500px;
        }

        .sidebar {
            width: 350px;
            background: white;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--safe));
            color: white;
        }

        .sidebar-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sidebar-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-item {
            background: rgba(242, 92, 84, 0.1);
            border-left: 4px solid var(--accent);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .alert-item.warning {
            background: rgba(249, 168, 37, 0.1);
            border-left-color: var(--warning);
        }

        .alert-item.info {
            background: rgba(26, 115, 232, 0.1);
            border-left-color: var(--primary);
        }

        .alert-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            color: var(--dark);
        }

        .alert-time {
            font-size: 0.8rem;
            color: #666;
        }

        .alert-desc {
            font-size: 0.9rem;
            color: #666;
        }

        .route-item {
            background: rgba(52, 168, 83, 0.1);
            border: 1px solid rgba(52, 168, 83, 0.3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .route-name {
            font-weight: 600;
            color: var(--secondary);
        }

        .route-distance {
            font-size: 0.8rem;
            color: #666;
        }

        .route-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.clear {
            background: var(--secondary);
        }

        .status-dot.congested {
            background: var(--warning);
        }

        .status-dot.blocked {
            background: var(--accent);
        }

        .crowd-meter {
            background: #f0f0f0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .crowd-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .crowd-label {
            font-weight: 600;
            color: var(--dark);
        }

        .crowd-value {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .crowd-value.low {
            color: var(--secondary);
        }

        .crowd-value.medium {
            color: var(--warning);
        }

        .crowd-value.high {
            color: var(--accent);
        }

        .crowd-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .crowd-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .crowd-fill.low {
            background: var(--secondary);
        }

        .crowd-fill.medium {
            background: var(--warning);
        }

        .crowd-fill.high {
            background: var(--accent);
        }

        .safety-recommendations {
            background: rgba(66, 133, 244, 0.1);
            border-radius: 12px;
            padding: 15px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
        }

        .recommendation-item:last-child {
            margin-bottom: 0;
        }

        .recommendation-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .recommendation-text {
            font-size: 0.9rem;
            color: var(--dark);
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-label {
            font-size: 0.8rem;
            color: var(--dark);
        }

        .tracking-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .tracking-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tracking-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--secondary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .location-coords {
            font-size: 0.8rem;
            color: #666;
        }

        @media (max-width: 1200px) {
            .sidebar {
                width: 300px;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .map-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 300px;
                order: -1;
            }

            .map-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .control-group {
                flex-wrap: wrap;
            }

            .legend, .tracking-info {
                position: relative;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-map-marked-alt"></i>
                Advanced Mapping & Tracking
            </div>
            <ul class="nav-menu">
                <li><a href="dashboard-student.html">Dashboard</a></li>
                <li><a href="education-modules.html">Education</a></li>
                <li><a href="profile-badges.html">Profile</a></li>
                <li><a href="consultation.html">Consultation</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="map-controls">
            <div class="control-group">
                <span class="control-label">Disaster Type:</span>
                <select class="control-select" id="disasterFilter">
                    <option value="all">All Disasters</option>
                    <option value="flood">Flood</option>
                    <option value="earthquake">Earthquake</option>
                    <option value="fire">Wildfire</option>
                    <option value="storm">Storm</option>
                    <option value="landslide">Landslide</option>
                </select>
            </div>

            <div class="control-group">
                <span class="control-label">Map Layer:</span>
                <select class="control-select" id="mapLayer">
                    <option value="terrain">Terrain</option>
                    <option value="satellite">Satellite</option>
                    <option value="road">Road Map</option>
                    <option value="hybrid">Hybrid</option>
                </select>
            </div>

            <div class="control-group">
                <button class="control-btn btn-primary" onclick="findEvacuationRoutes()">
                    <i class="fas fa-route"></i>
                    Find Routes
                </button>
                <button class="control-btn btn-warning" onclick="analyzeTraffic()">
                    <i class="fas fa-traffic-light"></i>
                    Traffic Analysis
                </button>
                <button class="control-btn btn-danger" onclick="emergencyMode()">
                    <i class="fas fa-exclamation-triangle"></i>
                    Emergency Mode
                </button>
            </div>

            <div class="control-group">
                <span class="control-label">Search Location:</span>
                <input type="text" class="control-input" placeholder="Enter address or landmark" id="locationSearch">
                <button class="control-btn btn-primary" onclick="searchLocation()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
            
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">Real-time Updates</div>
                    <div class="sidebar-subtitle">Live disaster tracking & alerts</div>
                </div>
                
                <div class="sidebar-content">
                    <div class="section">
                        <h3 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Active Alerts
                        </h3>
                        
                        <div class="alert-item">
                            <div class="alert-header">
                                <span class="alert-title">üî• Wildfire Warning</span>
                                <span class="alert-time">2 min ago</span>
                            </div>
                            <div class="alert-desc">Active wildfire detected 15km northeast. Evacuation recommended for zones A-C.</div>
                        </div>

                        <div class="alert-item warning">
                            <div class="alert-header">
                                <span class="alert-title">‚õàÔ∏è Severe Storm Alert</span>
                                <span class="alert-time">8 min ago</span>
                            </div>
                            <div class="alert-desc">Heavy rainfall expected. Flash flood risk in low-lying areas.</div>
                        </div>

                        <div class="alert-item info">
                            <div class="alert-header">
                                <span class="alert-title">üöß Road Closure</span>
                                <span class="alert-time">15 min ago</span>
                            </div>
                            <div class="alert-desc">Highway 101 closed due to landslide. Use alternate Route 85.</div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">
                            <i class="fas fa-route"></i>
                            Evacuation Routes
                        </h3>
                        
                        <div class="route-item">
                            <div class="route-header">
                                <span class="route-name">Route A - Primary</span>
                                <span class="route-distance">12.3 km</span>
                            </div>
                            <div class="route-status">
                                <div class="status-dot clear"></div>
                                <span>Clear - 15 min ETA</span>
                            </div>
                        </div>

                        <div class="route-item">
                            <div class="route-header">
                                <span class="route-name">Route B - Secondary</span>
                                <span class="route-distance">18.7 km</span>
                            </div>
                            <div class="route-status">
                                <div class="status-dot congested"></div>
                                <span>Congested - 28 min ETA</span>
                            </div>
                        </div>

                        <div class="route-item">
                            <div class="route-header">
                                <span class="route-name">Route C - Emergency</span>
                                <span class="route-distance">22.1 km</span>
                            </div>
                            <div class="route-status">
                                <div class="status-dot blocked"></div>
                                <span>Partially Blocked</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">
                            <i class="fas fa-users"></i>
                            Crowd Analysis
                        </h3>
                        
                        <div class="crowd-meter">
                            <div class="crowd-level">
                                <span class="crowd-label">Evacuation Centers</span>
                                <span class="crowd-value medium">67%</span>
                            </div>
                            <div class="crowd-bar">
                                <div class="crowd-fill medium" style="width: 67%;"></div>
                            </div>
                        </div>

                        <div class="crowd-meter">
                            <div class="crowd-level">
                                <span class="crowd-label">Main Routes</span>
                                <span class="crowd-value high">89%</span>
                            </div>
                            <div class="crowd-bar">
                                <div class="crowd-fill high" style="width: 89%;"></div>
                            </div>
                        </div>

                        <div class="crowd-meter">
                            <div class="crowd-level">
                                <span class="crowd-label">Safe Zones</span>
                                <span class="crowd-value low">34%</span>
                            </div>
                            <div class="crowd-bar">
                                <div class="crowd-fill low" style="width: 34%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3 class="section-title">
                            <i class="fas fa-shield-alt"></i>
                            Safety Recommendations
                        </h3>
                        
                        <div class="safety-recommendations">
                            <div class="recommendation-item">
                                <div class="recommendation-icon">
                                    <i class="fas fa-exclamation"></i>
                                </div>
                                <div class="recommendation-text">
                                    Avoid Highway 101 due to landslide risk
                                </div>
                            </div>

                            <div class="recommendation-item">
                                <div class="recommendation-icon">
                                    <i class="fas fa-route"></i>
                                </div>
                                <div class="recommendation-text">
                                    Use Route A for fastest evacuation (15 min)
                                </div>
                            </div>

                            <div class="recommendation-item">
                                <div class="recommendation-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="recommendation-text">
                                    Shelter capacity available at Memorial Center
                                </div>
                            </div>

                            <div class="recommendation-item">
                                <div class="recommendation-icon">
                                    <i class="fas fa-phone"></i>
                                </div>
                                <div class="recommendation-text">
                                    Keep emergency contacts updated on location
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-title">Map Legend</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f25c54;"></div>
                    <span class="legend-label">High Risk Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f9a825;"></div>
                    <span class="legend-label">Medium Risk Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #34a853;"></div>
                    <span class="legend-label">Safe Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #1a73e8;"></div>
                    <span class="legend-label">Evacuation Route</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9c27b0;"></div>
                    <span class="legend-label">Emergency Services</span>
                </div>
            </div>

            <div class="tracking-info">
                <div class="tracking-status">
                    <div class="tracking-dot"></div>
                    <span style="font-weight: 600;">Live Tracking Active</span>
                </div>
                <div class="location-coords">
                    <div>Lat: 37.7749¬∞ N</div>
                    <div>Lng: 122.4194¬∞ W</div>
                    <div>Accuracy: ¬±3m</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map;
        let userMarker;
        let evacuationRoutes = [];
        let disasterMarkers = [];

        // Initialize map
        function initMap() {
            // Create map centered on San Francisco (example location)
            map = L.map('map').setView([37.7749, -122.4194], 12);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // Add user location marker
            addUserLocation();
            
            // Add disaster markers
            addDisasterMarkers();
            
            // Add evacuation centers
            addEvacuationCenters();
            
            // Add risk zones
            addRiskZones();
        }

        function addUserLocation() {
            const userIcon = L.divIcon({
                className: 'user-marker',
                html: `<div style="
                    width: 20px; 
                    height: 20px; 
                    background: #1a73e8; 
                    border: 3px solid white; 
                    border-radius: 50%; 
                    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    animation: pulse 2s infinite;
                "></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            userMarker = L.marker([37.7749, -122.4194], { icon: userIcon })
                .addTo(map)
                .bindPopup('<b>Your Location</b><br>Currently tracking your position');
        }

        function addDisasterMarkers() {
            const disasters = [
                {
                    type: 'wildfire',
                    position: [37.8044, -122.2712],
                    title: 'Active Wildfire',
                    description: 'Wildfire spreading northeast. Evacuation Zone A-C.',
                    severity: 'high',
                    icon: 'üî•'
                },
                {
                    type: 'flood',
                    position: [37.7849, -122.4094],
                    title: 'Flood Warning',
                    description: 'Heavy rainfall causing flash flood risk.',
                    severity: 'medium',
                    icon: 'üåä'
                },
                {
                    type: 'landslide',
                    position: [37.7549, -122.4494],
                    title: 'Landslide Risk',
                    description: 'Highway 101 closure due to landslide.',
                    severity: 'high',
                    icon: '‚õ∞Ô∏è'
                }
            ];

            disasters.forEach(disaster => {
                const color = disaster.severity === 'high' ? '#f25c54' : 
                             disaster.severity === 'medium' ? '#f9a825' : '#34a853';

                const disasterIcon = L.divIcon({
                    className: 'disaster-marker',
                    html: `<div style="
                        width: 30px; 
                        height: 30px; 
                        background: ${color}; 
                        border: 2px solid white; 
                        border-radius: 50%; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        font-size: 14px;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                        animation: ${disaster.severity === 'high' ? 'pulse 1s infinite' : 'none'};
                    ">${disaster.icon}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                const marker = L.marker(disaster.position, { icon: disasterIcon })
                    .addTo(map)
                    .bindPopup(`<b>${disaster.title}</b><br>${disaster.description}`);
                
                disasterMarkers.push(marker);
            });
        }

        function addEvacuationCenters() {
            const centers = [
                { position: [37.7649, -122.4094], name: 'Memorial Community Center', capacity: '500 people' },
                { position: [37.7949, -122.3894], name: 'Central High School', capacity: '800 people' },
                { position: [37.7449, -122.4394], name: 'Sports Complex Arena', capacity: '1200 people' }
            ];

            centers.forEach(center => {
                const centerIcon = L.divIcon({
                    className: 'center-marker',
                    html: `<div style="
                        width: 25px; 
                        height: 25px; 
                        background: #34a853; 
                        border: 2px solid white; 
                        border-radius: 3px; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        color: white; 
                        font-weight: bold;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    ">üè†</div>`,
                    iconSize: [25, 25],
                    iconAnchor: [12, 12]
                });

                L.marker(center.position, { icon: centerIcon })
                    .addTo(map)
                    .bindPopup(`<b>${center.name}</b><br>Capacity: ${center.capacity}<br><button onclick="navigateToCenter('${center.name}')">Navigate</button>`);
            });
        }

        function addRiskZones() {
            // High risk zone (wildfire area)
            const highRiskZone = L.circle([37.8044, -122.2712], {
                color: '#f25c54',
                fillColor: '#f25c54',
                fillOpacity: 0.2,
                radius: 3000
            }).addTo(map).bindPopup('High Risk Zone - Immediate Evacuation Required');

            // Medium risk zone (flood area)
            const mediumRiskZone = L.circle([37.7849, -122.4094], {
                color: '#f9a825',
                fillColor: '#f9a825',
                fillOpacity: 0.2,
                radius: 2000
            }).addTo(map).bindPopup('Medium Risk Zone - Evacuation Recommended');

            // Safe zone
            const safeZone = L.circle([37.7449, -122.4394], {
                color: '#34a853',
                fillColor: '#34a853',
                fillOpacity: 0.2,
                radius: 2500
            }).addTo(map).bindPopup('Safe Zone - Shelter Available');
        }

        function findEvacuationRoutes() {
            // Clear existing routes
            evacuationRoutes.forEach(route => map.removeLayer(route));
            evacuationRoutes = [];

            const routes = [
                {
                    name: 'Route A - Primary',
                    coordinates: [
                        [37.7749, -122.4194],
                        [37.7649, -122.4094],
                        [37.7549, -122.3994]
                    ],
                    color: '#34a853'
                },
                {
                    name: 'Route B - Secondary',
                    coordinates: [
                        [37.7749, -122.4194],
                        [37.7849, -122.3894],
                        [37.7949, -122.3794]
                    ],
                    color: '#f9a825'
                },
                {
                    name: 'Route C - Emergency',
                    coordinates: [
                        [37.7749, -122.4194],
                        [37.7449, -122.4394],
                        [37.7349, -122.4294]
                    ],
                    color: '#f25c54'
                }
            ];

            routes.forEach(route => {
                const polyline = L.polyline(route.coordinates, {
                    color: route.color,
                    weight: 5,
                    opacity: 0.8
                }).addTo(map).bindPopup(route.name);
                
                evacuationRoutes.push(polyline);
            });

            alert('‚úÖ Evacuation routes calculated!\n\nüî∏ Route A: Clear - 15 min ETA\nüî∏ Route B: Congested - 28 min ETA\nüî∏ Route C: Partially blocked\n\nRecommendation: Use Route A for fastest evacuation.');
        }

        function analyzeTraffic() {
            // Simulate traffic analysis
            const analysis = {
                mainRoutes: Math.floor(Math.random() * 40) + 60,
                evacuationCenters: Math.floor(Math.random() * 30) + 50,
                safeZones: Math.floor(Math.random() * 50) + 20
            };

            // Update crowd meters
            updateCrowdMeter('Main Routes', analysis.mainRoutes);
            updateCrowdMeter('Evacuation Centers', analysis.evacuationCenters);
            updateCrowdMeter('Safe Zones', analysis.safeZones);

            alert(`üö¶ Traffic Analysis Complete!\n\nüìä Current Congestion Levels:\n‚Ä¢ Main Routes: ${analysis.mainRoutes}%\n‚Ä¢ Evacuation Centers: ${analysis.evacuationCenters}%\n‚Ä¢ Safe Zones: ${analysis.safeZones}%\n\nRecommendation: Consider alternate routes if main routes exceed 80% capacity.`);
        }

        function updateCrowdMeter(location, percentage) {
            const meters = document.querySelectorAll('.crowd-meter');
            meters.forEach(meter => {
                const label = meter.querySelector('.crowd-label');
                if (label.textContent === location) {
                    const value = meter.querySelector('.crowd-value');
                    const fill = meter.querySelector('.crowd-fill');
                    
                    value.textContent = percentage + '%';
                    fill.style.width = percentage + '%';
                    
                    // Update colors based on percentage
                    const levelClass = percentage < 50 ? 'low' : percentage < 75 ? 'medium' : 'high';
                    value.className = `crowd-value ${levelClass}`;
                    fill.className = `crowd-fill ${levelClass}`;
                }
            });
        }

        function emergencyMode() {
            // Activate emergency features
            map.setView([37.7749, -122.4194], 14);
            
            // Flash emergency markers
            disasterMarkers.forEach(marker => {
                const element = marker.getElement();
                if (element) {
                    element.style.animation = 'pulse 0.5s infinite';
                }
            });

            // Show emergency popup
            const emergencyPopup = L.popup()
                .setLatLng([37.7749, -122.4194])
                .setContent(`
                    <div style="text-align: center; color: #f25c54;">
                        <h3>üö® EMERGENCY MODE ACTIVATED</h3>
                        <p>‚Ä¢ All emergency services notified</p>
                        <p>‚Ä¢ Real-time tracking enabled</p>
                        <p>‚Ä¢ Priority evacuation routes calculated</p>
                        <button onclick="callEmergency()" style="background: #f25c54; color: white; border: none; padding: 8px 16px; border-radius: 5px; margin-top: 10px;">Call 911</button>
                    </div>
                `)
                .openOn(map);

            alert('üö® EMERGENCY MODE ACTIVATED!\n\n‚úÖ Emergency services have been notified\n‚úÖ Your location is being tracked\n‚úÖ Priority evacuation routes calculated\n‚úÖ Emergency contacts alerted\n\nStay calm and follow evacuation instructions.');
        }

        function searchLocation() {
            const query = document.getElementById('locationSearch').value;
            if (!query) return;

            // Simulate location search (in real app, would use geocoding API)
            const searchResults = [
                { name: 'City Hall', coordinates: [37.7793, -122.4193] },
                { name: 'Golden Gate Park', coordinates: [37.7694, -122.4862] },
                { name: 'Fisherman\'s Wharf', coordinates: [37.8080, -122.4177] }
            ];

            const result = searchResults.find(location => 
                location.name.toLowerCase().includes(query.toLowerCase())
            );

            if (result) {
                map.setView(result.coordinates, 15);
                L.popup()
                    .setLatLng(result.coordinates)
                    .setContent(`<b>${result.name}</b><br>Search result`)
                    .openOn(map);
            } else {
                alert(`Location "${query}" not found. Try searching for: City Hall, Golden Gate Park, or Fisherman's Wharf`);
            }
        }

        function navigateToCenter(centerName) {
            alert(`üß≠ Navigation started to ${centerName}\n\nEstimated arrival: 12 minutes\nDistance: 3.2 km\nRoute conditions: Clear\n\nFollow the blue route on the map.`);
            findEvacuationRoutes();
        }

        function callEmergency() {
            alert('üìû Connecting to Emergency Services...\n\nüö® 911 - General Emergency\nüî• Fire Department\nüöë Medical Emergency\nüëÆ Police\n\nYour location has been shared with emergency responders.');
        }

        // Simulate real-time updates
        function simulateRealTimeUpdates() {
            setInterval(() => {
                // Update crowd levels
                const crowdMeters = document.querySelectorAll('.crowd-meter');
                crowdMeters.forEach(meter => {
                    const value = meter.querySelector('.crowd-value');
                    const fill = meter.querySelector('.crowd-fill');
                    const currentValue = parseInt(value.textContent);
                    const newValue = Math.max(0, Math.min(100, currentValue + (Math.random() - 0.5) * 10));
                    
                    value.textContent = Math.round(newValue) + '%';
                    fill.style.width = newValue + '%';
                    
                    const levelClass = newValue < 50 ? 'low' : newValue < 75 ? 'medium' : 'high';
                    value.className = `crowd-value ${levelClass}`;
                    fill.className = `crowd-fill ${levelClass}`;
                });

                // Update location coordinates (simulate GPS movement)
                const coords = document.querySelectorAll('.location-coords div');
                if (coords.length >= 2) {
                    const lat = (37.7749 + (Math.random() - 0.5) * 0.001).toFixed(4);
                    const lng = (-122.4194 + (Math.random() - 0.5) * 0.001).toFixed(4);
                    coords[0].textContent = `Lat: ${lat}¬∞ N`;
                    coords[1].textContent = `Lng: ${lng}¬∞ W`;
                }
            }, 5000); // Update every 5 seconds
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            simulateRealTimeUpdates();

            // Add CSS for animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0%, 100% { opacity: 1; transform: scale(1); }
                    50% { opacity: 0.7; transform: scale(1.1); }
                }
            `;
            document.head.appendChild(style);
        });

        // Map layer switching
        document.getElementById('mapLayer').addEventListener('change', function(e) {
            // In a real application, this would switch between different map tile providers
            const layer = e.target.value;
            console.log(`Switching to ${layer} layer`);
            
            // Simulate layer change feedback
            const layerNames = {
                terrain: 'Terrain View',
                satellite: 'Satellite View', 
                road: 'Road Map View',
                hybrid: 'Hybrid View'
            };
            
            alert(`üìç Map layer switched to: ${layerNames[layer]}`);
        });

        // Disaster filter
        document.getElementById('disasterFilter').addEventListener('change', function(e) {
            const filter = e.target.value;
            console.log(`Filtering disasters: ${filter}`);
            
            // In a real app, this would filter the visible disaster markers
            if (filter === 'all') {
                alert('üìç Showing all disaster types');
            } else {
                alert(`üìç Filtering to show only: ${filter} disasters`);
            }
        });
    </script>
</body>
</html>